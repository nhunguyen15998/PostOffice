@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "Branch management";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
@model post_office.Models.BranchModel
<div class="col-12" style="display: table; background: white; top: 20px;box-shadow: rgb(248 242 225 / 0.92) 10px 10px 20px 5px; padding:20px">
    <div style="height:50px;position:relative; padding:0">
        <button class="btn-action delete" id="btnDelete" style="float:left;margin-right:2vw">Delete</button>
        <input class="input-search form-control" style="float:left;width:380px;" type="text" placeholder="Search by code, name" />
        <button class="btn-action save" id="btnCreate" style="float:right;">Create</button>

    </div>
    <table class="table" style=" border:2px solid #ddd;width:inherit" id="table-id">
        <tr style="color: white; background: #747583">
            <th><input type="checkbox" id="check-all" onclick="SelectAll(this)" /></th>
            <th>#</th>
            <th>Code</th>
            <th>Name</th>
            <th>Phone</th>
            <th>Province</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
        <tr class="table-item">
            <td class="tbl-20"><input type="checkbox" class="sub-check" post-item="post-" /></td>
            <td class="tbl-30">1</td>
            <td class="tbl-200">bababbabnannanasbbsbsbbsbbababbababba</td>
            <td class="tbl-200">babbababbababbabba</td>
            <td class="tbl-120">babababbaba</td>
            <td class="tbl-120">annananaaa</td>
            <td class="sts-item tbl-40" id="sts-"></td>
            <td class="tbl-180">
                <span oid="object-1" class="action-icon view view-branch" style="padding:10px 5px 10px 10px">
                    <i class="fa fa-eye"></i>
                </span>
                <span oid="object-1" class="action-icon edit edit-branch" style="padding:10px 5px 10px 10px">
                    <i class="fa fa-edit"></i>
                </span>

                <span oid="object-1" class="action-icon delete delete-branch">
                    <i class="fa fa-trash"></i>
                </span>
            </td>
        </tr>


    </table>
    <div class="pagination-container" style="cursor:pointer">
        <nav aria-label="Page navigation example" style="position:unset;box-shadow:none; background:none;padding:0">
            <ul class="pagination" id="paginations">
                <li class="page-item page-link" data-page="prev">&lt;</li>
                @for (int i = 1; i <= ViewBag.pagi; i++)
                {
                    if (i == 1)
                    {
                        <li class="page-item page-link" data-page="page-1" style="background:#ddd">@i</li>

                    }
                    else
                    {
                        <li class="page-item page-link" data-page="page-@i">@i</li>
                    }
                }
                <li class="page-item page-link" data-page="next">&gt;</li>
            </ul>
        </nav>
    </div>
</div>
<div id="view-main">
    <div id="view-sub" class="col-11">
        <div class="col-12" id="view-title">
            <label></label>
            <span style="float:right; cursor:pointer" id="CloseForm">
                <i class="fa fa-window-close" style="pointer-events:none;font-size:38px"></i>
            </span>
        </div>
        <div id="content">
            @using (Html.BeginForm("BranchCU", "Auth", FormMethod.Post, new { @id = "form-branch" }))
            {
                <div class="col-12" style="padding:20px;min-height:450px;display:table;">
                    <div class="col-6" style="border-right:3px solid #f4e8e4;min-height:inherit;float:left">
                        @Html.AntiForgeryToken()@Html.HiddenFor(x => x.id)
                        <label class="text-color mt-3">
                            Code:
                            <span class="text-readonly">4444111558755874</span>
                        </label>
                        <br />
                        <label class="text-color">Name:</label>
                        @Html.TextBoxFor(d => d.name, new { @class = "input-form-cu", @type = "text", @placeholder = "name" })
                        @Html.ValidationMessageFor(d => d.name, "", new { @class = "_error" })
                        <br />
                        <label class="text-color">Phone:</label>
                        @Html.TextBoxFor(d => d.phone, new { @class = "input-form-cu", @type = "text", @placeholder = "phone" })
                        @Html.ValidationMessageFor(d => d.phone, "", new { @class = "_error" })
                        <br />

                        <label class="text-color">Status:</label>
                        @Html.DropDownListFor(model => model.status, new SelectList(ViewBag.ls_status, "Key", "Value"), new { @style = "", @class = "dropdownlist" })
                       
                    </div>
                    <div class="col-6" style="min-height:inherit;float:left">
                        <label class="text-color mt-5">Address:</label>
                        @Html.TextBoxFor(d => d.address, new { @class = "input-form-cu", @type = "text", @placeholder = "address" })
                        @Html.ValidationMessageFor(d => d.phone, "", new { @class = "_error" })
                        <br />
                        <label class="text-color">Province:</label>
                        @Html.DropDownListFor(model => model.provinceId, (IEnumerable<SelectListItem>)ViewBag.provinceList, null, new { @class = "dropdownlist", @id = "provinceSlt" })
                        @Html.ValidationMessageFor(d => d.provinceId, "", new { @class = "_error" })
                        <br />
                        <label class="text-color">City:</label>
                        @Html.DropDownListFor(model => model.cityId, new List<SelectListItem> { new SelectListItem { Value = "0", Text = "Select city" } }, new { @class = "dropdownlist", @id = "citySlt" })
                        @Html.ValidationMessageFor(d => d.cityId, "", new { @class = "_error" })
                        <br />
                        <label class="text-color">Ward :</label>
                        @Html.DropDownListFor(model => model.wardId, new List<SelectListItem> { new SelectListItem { Value = "0", Text = "Select ward" } }, new { @class = "dropdownlist", @id = "wardSlt" })
                        @Html.ValidationMessageFor(d => d.wardId, "", new { @class = "_error" })
                        <br />
                    </div>
                </div>
                <div class="col-12" style=" min-height: 70px; border-radius: 0 0 5px 5px; text-align:center">
                    <button id="btnBranchSave" type="submit" class="save btn-action pl-4 pr-4 pt-2 pb-2">Save</button>
                    <a id="btnBranchCancel" onclick="ResetForm()" class="cancel btn-action ml-1" style="cursor:pointer; padding:12px 25px">Cancel</a>
                </div>
            }
        </div>

    </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<script type="text/javascript">
     var pages = 1;
    window.onload = function () {

        var mess = "@(post_office.Controllers.Administrator.BranchController.mess)";
        if (mess == "Saved successfully!" || mess == "Deleted successfully!")
            ShowMessage(true, mess)
        else if (mess != "Saved successfully!" && mess != "")
            ShowMessage(false, mess)
           @{post_office.Controllers.Administrator.BranchController.mess = "";}
        $("#citySlt").attr("disabled","disabled")
        $("#wardSlt").attr("disabled","disabled")

    }
    $("#provinceSlt").change(function () {
        if ($(this).val() != 0) {
            $("#citySlt").removeAttr("disabled");
            var formData = new FormData();
            formData.append("stateID",$(this).val())
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetCityByStateID", "Branch")",
                data: formData,
                processData: false,
                contentType: false,
                success: function (data) {
                    $("#citySlt").empty();
                    $("#citySlt").append('<option value="0">Select city</option>');
                    for (var i = 0; i < data.length; i++) {
                        $("#citySlt").append('<option value="'+data[i].Id+'">'+data[i].Name+'</option>')

                    }

                }
            });
        } else {
            $("#citySlt").val(0);
            $("#wardSlt").val(0);
            $("#citySlt").attr("disabled", "disabled")
            $("#wardSlt").attr("disabled", "disabled")
        };
    });
    $("#citySlt").change(function () {
        if ($(this).val() != 0) {
            $("#wardSlt").removeAttr("disabled");
            var formData = new FormData();
            formData.append("cityID",$(this).val())
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetWardByCityID", "Branch")",
                data: formData,
                processData: false,
                contentType: false,
                success: function (data) {
                    $("#wardSlt").empty();
                    $("#wardSlt").append('<option value="0">Select ward</option>');
                    for (var i = 0; i < data.length; i++) {
                        $("#wardSlt").append('<option value="'+data[i].Id+'">'+data[i].Name+'</option>')

                    }

                }
            });
        } else {
            $("#wardSlt").val(0);
            $("#wardSlt").attr("disabled", "disabled")
        };
    });
    $("#btnCreate").click(function () {
        OpenForm("Create branch",0);
    });
    $(".edit-branch").click(function () {
        var id = $(this).attr("oid").replace("object-", "");
        OpenForm("Update branch",id)
    });
    function OpenForm(type, id) {
        $("#content").append('');
        $("#view-main").css("display", "block");
        document.getElementById("view-title").children[0].innerHTML = type;
        $(".sidebar").css("pointer-events", "none")


    }
    $("#CloseForm").click(function () {
        ResetForm();
    });

    function ResetForm() {
        CloseForm();
        @{post_office.Controllers.Administrator.BranchController.id = 0; }

        er = document.getElementsByClassName("_error");
        for (var i = 0; i < er.length; i++) {
            $(er).html("");
        }
        $("#form-branch").trigger("reset");

    }
    $('#btnBranchSave').click(function () {
        er = document.getElementsByClassName("_error");
        for (var i = 0; i < er.length; i++) {
            if ($(er[i]).html().length > 0) {
                $(er[i]).shake();

            }
        }
    });
</script>